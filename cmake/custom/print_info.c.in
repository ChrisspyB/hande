#include <stdio.h>
#include <unistd.h>

/*
 * Print the configuration/build info generated at build time by the executable.
 * We do this from C and not from Fortran because Fortran has trouble with long
 * lines.
 */

void print_info(void) {
  printf("\n");
  printf("\n");
  printf("Version information\n");
  printf("-------------------\n");
  printf("\n");
  printf("Version       | %s\n", "@_git_describe@");
  printf("Commit hash   | %s\n", "@_git_last_commit_hash@");
  printf("Commit author | %s\n", "@_git_last_commit_author@");
  printf("Commit date   | %s\n", "@_git_last_commit_date@");
  printf("Branch        | %s\n", "@_git_branch@");

  printf("\n");
  printf("\n");
  printf("Configuration and build information\n");
  printf("-----------------------------------\n");
  printf("\n");
  printf("Who compiled             | %s\n", "@_user_name@");
  printf("Compilation hostname     | %s\n", "@_host_name@");
  printf("Operating system         | %s\n", "@CMAKE_SYSTEM@");
  printf("CMake version            | %s\n", "@CMAKE_VERSION@");
  printf("CMake generator          | %s\n", "@CMAKE_GENERATOR@");
  printf("CMake build type         | %s\n", "@CMAKE_BUILD_TYPE@");
  printf("Configuration time       | %s\n", "@_configuration_time@");
  printf("Python version           | %s\n", "@PYTHON_VERSION_STRING@");
  printf("Fortran compiler         | %s\n", "@CMAKE_Fortran_COMPILER@");
  printf("C compiler               | %s\n", "@CMAKE_C_COMPILER@");
  printf("DET_SIZE set to          | %s\n", "@HANDE_DET_SIZE@");
  printf("POP_SIZE set to          | %s\n", "@HANDE_POP_SIZE@");
  printf("dSFMT Mersenne exponent  | %s\n", "@HANDE_DSFMT_MEXP@");
  printf("MPI parallelization      | %s\n", "@USE_MPI@");
  printf("MPI launcher             | %s\n", "@MPIEXEC@");
  printf("OpenMP parallelization   | %s\n", "@USE_OPENMP@");

  printf("\n");
  printf("\n");
  printf("Further components\n");
  printf("------------------\n");
  printf("\n");
  printf("   %s\n", "@_use_hdf5@");
  printf("   %s\n", "@_use_lanczos@");
  printf("   %s\n", "@_use_uuid@");
  printf("   %s\n", "@_use_scalapack@");
  printf("   %s\n", "@_use_popcnt@");
  printf("   %s\n", "@_use_single_precision@");

  printf("\n");
  printf("\n");
  printf("Runtime information\n");
  printf("-------------------\n");
  printf("\n");
  char hostname[1024];
  int stat = gethostname(hostname, 1024);
  if (stat == 0) {
    printf("Hostname:                               \n    %s\n", hostname);
  } else {
    printf("Hostname (truncated to 1024 characters):\n    %s\n", hostname);
  }
  char cwd[1024];
  if (getcwd(cwd, sizeof(cwd)) != NULL) {
    printf("Current working dir:                    \n    %s\n", cwd);
  } else {
    perror("getcwd() error");
  }

  fflush(stdout);
}
